/* esm.sh - unpdf@0.11.0 */
import __Process$ from "/node/process.mjs";
var c,m=__Process$?.release?.name==="node",v=typeof window<"u";async function u(t,a={}){let{getDocument:e}=await h();return await e({data:t,isEvalSupported:!1,useSystemFonts:!0,...a}).promise}async function h(){return c||await w(),c}async function w(t,{force:a=!1}={}){if(!(c&&!a)){if(t)try{c=await p(t()),c&&"resolvePDFJS"in c&&(c=await c.resolvePDFJS());return}catch{throw new Error("Resolving failed. Please check the provided configuration.")}try{let{resolvePDFJS:e}=await import("./pdfjs.mjs");c=await e()}catch{throw new Error("PDF.js is not available. Please add the package as a dependency.")}}}function g(t){return typeof t=="object"&&t!==null&&"_pdfInfo"in t}async function p(t){let a=await t;return a.default||a}async function y(t){let e=await(g(t)?t:await u(t)).getMetadata();return{info:e?.info??{},metadata:e?.metadata?.getAll()??{}}}async function P(t,a={}){let{mergePages:e=!1}={...a},r=g(t)?t:await u(t),n=await Promise.all(Array.from({length:r.numPages},(i,s)=>D(r,s+1)));return{totalPages:r.numPages,text:e?n.join(`
`).replace(/\s+/g," "):n}}async function D(t,a){return(await(await t.getPage(a)).getTextContent()).items.filter(n=>n.str!=null).map(n=>n.str+(n.hasEOL?`
`:"")).join("")}async function x(t,a){let e=g(t)?t:await u(t),r=await e.getPage(a);if(a<1||a>e.numPages)throw new Error(`Invalid page number. Must be between 1 and ${e.numPages}.`);let n=await r.getOperatorList(),{OPS:i}=await h(),s=[];for(let o=0;o<n.fnArray.length;o++){if(n.fnArray[o]!==i.paintImageXObject)continue;let l=n.argsArray[o][0],d=await r.objs.get(l);s.push(d.data)}return s}async function F(t,a,e={}){let r=await I(e.canvas),n=g(t)?t:await u(t,{canvasFactory:r}),i=await n.getPage(a);if(a<1||a>n.numPages)throw new Error(`Invalid page number. Must be between 1 and ${n.numPages}.`);let s=e.scale||1,o=i.getViewport({scale:s});e.width?s=e.width/o.width:e.height&&(s=e.height/o.height),s!==1&&s>0&&(o=i.getViewport({scale:s}));let f=r.create(o.width,o.height);await i.render({canvasContext:f.context,viewport:o}).promise;let l=f.canvas.toDataURL();return await(await fetch(l)).arrayBuffer()}async function I(t){let a=t?await p(t()):void 0;return{_createCanvas(e,r){if(v){let n=document.createElement("canvas");return n.width=e,n.height=r,n}if(m){if(!a)throw new Error('Failed to resolve "canvas" package.');return a.createCanvas(e,r)}throw new Error("Unsupported environment for canvas creation.")},create(e,r){let n=this._createCanvas(e,r),i=n.getContext("2d");return{canvas:n,context:i}},reset(e,r,n){e.canvas&&(e.canvas.width=r,e.canvas.height=n)},destroy(e){e.canvas&&(e.canvas.width=0,e.canvas.height=0),e.canvas=void 0,e.context=void 0}}}async function E(t){let{pdfjs:a}={...t};a&&await w(a,{force:!0})}var S=async(...t)=>(await w(),await y(...t)),b=async(...t)=>(await w(),await P(...t)),A=async(...t)=>(await w(),await x(...t)),C=async(...t)=>(await w(),await F(...t));export{E as configureUnPDF,I as createIsomorphicCanvasFactory,A as extractImages,b as extractText,u as getDocumentProxy,S as getMeta,h as getResolvedPDFJS,C as renderPageAsImage,w as resolvePDFJSImports};
//# sourceMappingURL=unpdf.mjs.map